! Configuration du tunnel VPN IPSEC (entre R1 et R4)
! Le but est de connecter les LAN de R1 et R4 en tout sécurité
! liens utilisés : https://cisco.goffinet.org/ccnp/vpn/lab-configuration-cisco-ios-ipsec-site-a-site-pre-shared-nat-entre-deux-reseaux-prive-firewall-parefeu/

! Bloc de commandes pour R4

interface G0/2
 ip address 10.104.1.1 255.255.255.0
 ip nat inside
 no shutdown
!
interface GigabitEthernet0/3
 ! ip address 10.104.122.250 255.255.255.0
 ip address dhcp
 ip nat outside
 no shutdown
!
ip dhcp pool lan
 network 10.104.14.0 255.255.255.0
 default-router 10.104.1.1
 dns-server 1.1.1.1
ip route 0.0.0.0 0.0.0.0 10.104.122.1
ip access-list extended LAN_NAT
 permit ip 10.104.14.0 0.0.0.255 any
!
ip nat inside source list LAN_NAT interface G0/3 overload
!
crypto isakmp policy 1
 encr aes 256
 authentication pre-share
 group 5
 lifetime 7200
!
crypto isakmp key cisco123 address 10.104.122.162
!
crypto ipsec transform-set to-R1-set esp-aes 256 esp-sha-hmac
!
crypto map cm-to-R1 1 ipsec-isakmp
 set peer 10.104.122.162
 set transform-set to-R1-set
 match address crypto-acl
!
interface G0/3
 crypto map cm-to-R1
!
ip access-list extended crypto-acl
 permit ip 10.104.14.0 0.0.0.255 10.104.59.0 0.0.0.255
!
ip access-list extended LAN_NAT
 5 deny ip 10.104.14.0 0.0.0.255 10.104.59.0 0.0.0.255
 10 permit ip 10.104.14.0 0.0.0.255 any
!
ip nat inside source list LAN_NAT interface G0/3 overload
end


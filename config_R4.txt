conf t
hostname R4
enable secret testtest
username root secret testtest
!
! Configurer et s√©curiser SSH
ip domain-name lan4
crypto key generate rsa
2048
!
access-list 1 permit 10.0.0.0 0.255.255.255
ip nat inside source list 1 interface g0/1 overload
!
! Configurer l'adressage IPv4 et IPv6  
interface GigabitEthernet0/1
ip address dhcp
ip nat outside
ipv6 address fe80::dd:4 link-local
ipv6 address fd00:470:c814:1004::1/64
no shutdown
exit
!
interface GigabitEthernet0/2
ip nat inside
ip address 10.104.1.1 255.255.255.0
ipv6 address fe80::dd:4 link-local
ipv6 address fd00:470:c814:1004::2/64
no shutdown
end
!
conf t
ip domain lookup
ip name-server 1.1.1.1
ip dns server
!
ip dhcp pool LAN
network 10.104.1.0 255.255.255.0
default-router 10.104.1.1
dns-server 10.104.1.1
!
exit
!
ipv6 unicast-routing
!
end
wr

! CONFIGURATION DU FIREWALL
!
conf t
ip dhcp pool LAN
   network 10.104.1.0 255.255.255.0
   default-router 10.104.1.1
   dns-server 1.1.1.1
!
ip domain name lan
!
ip domain-lookup
!
username root secret testtest
!
class-map type inspect match-any icmp-class
 match protocol icmp
class-map type inspect match-any remote-access-class
 match access-group name SSH
class-map type inspect match-any dhcp-class
 match access-group name DHCP
class-map type inspect match-any dns-class
 match access-group name DNS
class-map type inspect match-any internet-trafic-class
 match protocol dns
 match protocol http
 match protocol https
 match protocol icmp
!
!
policy-map type inspect to-self-policy
 class type inspect remote-access-class
  pass
 class type inspect icmp-class
  inspect
 class type inspect dhcp-class
  pass
 class type inspect dns-class
  pass
 class class-default
  drop log
policy-map type inspect lan-internet-policy
 class type inspect internet-trafic-class
  inspect
 class class-default
!
zone security lan4
zone security internet
zone-pair security lan4-internet source lan4 destination internet
 service-policy type inspect lan4-internet-policy
zone-pair security internet-self source internet destination self
 service-policy type inspect to-self-policy
!
interface G0/1
 description Interface WAN
 ip address dhcp
 ip nat outside
 zone-member security internet
 no shutdown
!
interface G0/2
 description Interface LAN
 ip address 10.104.1.1 255.255.255.0
 zone-member security lan4
 no shutdown
!
ip dns server
ip nat inside source list LAN_NAT interface G0/1 overload
!
ip access-list extended LAN_NAT
 permit ip 10.0.0.0 0.0.0.255 any
ip access-list extended SSH
 permit tcp any any eq 22
 deny   ip any any
ip access-list extended DHCP
 permit udp any any eq 68
 deny udp any any
ip access-list extended DNS
 permit udp any any eq 53
 deny udp any any
!
line con 0
 exec-timeout 0 0
 privilege level 15
 logging synchronous
line aux 0
 exec-timeout 0 0
 privilege level 15
 logging synchronous
line vty 0 4
 login local
 transport input ssh
!
end
wr
!
! CONFIGURATION DU VPN IPSEC

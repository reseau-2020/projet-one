! Configuration du tunnel VPN IPSEC (entre R2 et R3)
! Le but est de connecter les LAN de R2 et R3 en tout sécurité
! liens utilisés : https://cisco.goffinet.org/ccnp/vpn/lab-configuration-cisco-ios-ipsec-site-a-site-pre-shared-nat-entre-deux-reseaux-prive/
! liens utilisés : https://www.cisco.com/c/en/us/support/docs/security-vpn/ipsec-negotiation-ike-protocols/7276-overload-private.html


! Bloc de commandes pour R2

crypto isakmp policy 1
 encr aes 256
 authentication pre-share
 group 5
!
crypto isakmp key cisco123 address 10.1.2.2
!
crypto ipsec transform-set to-R3-set esp-aes 256 esp-sha-hmac
!
crypto map cm-to-R3 1 ipsec-isakmp
 set peer 10.1.2.2
 set transform-set to-R3-set
 match address crypto-acl
!
interface G0/1
 ip address 10.1.1.2 255.255.255.0
 ip nat outside
 no shutdown
 crypto map cm-to-R3
!
interface G0/0
 ip address 10.192.0.1 255.255.255.0
 ip nat inside
 no shutdown
!
ip route 0.0.0.0 0.0.0.0 10.1.1.1 222
!
ip nat inside source route-map nonat interface G0/1 overload
!
ip access-list extended nonat-acl
 deny ip 10.192.0.0 0.0.0.255 10.193.0.0 0.0.0.255
 permit ip 10.192.0.0 0.0.0.255 any
!
ip access-list extended crypto-acl
 permit ip 10.192.0.0 0.0.0.255 10.193.0.0 0.0.0.255
!
route-map nonat permit 10
 match ip address nonat-acl
!
end
